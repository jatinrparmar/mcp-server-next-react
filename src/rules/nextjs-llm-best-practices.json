{
  "meta": {
    "framework": "Next.js",
    "version": "2025.1",
    "type": "best-practices",
    "router": "app",
    "intendedFor": ["LLMs", "GitHub Copilot", "documentation-reference"],
    "description": "Comprehensive best practices guide for LLMs to reference when working with Next.js applications"
  },
  "rules": [
    {
      "id": "react-19-features",
      "title": "Adopt React 19 Hooks",
      "intent": "Prefer React 19 features like useActionState, useOptimistic, and useFormStatus where they simplify UI updates",
      "scope": "component",
      "severity": "warning",
      "rule": "react-19-features"
    },
    {
      "id": "avoid-localstorage",
      "title": "Avoid localStorage for app state or secrets",
      "intent": "Do not store app state or sensitive data in localStorage/sessionStorage",
      "scope": "component",
      "severity": "error",
      "rule": "avoid-localstorage"
    },
    {
      "id": "centralized-error-handling",
      "title": "Centralize API error handling",
      "intent": "Wrap API calls with try/catch and send errors to a shared handler/logger",
      "scope": "component",
      "severity": "warning",
      "rule": "centralized-error-handling"
    },
    {
      "id": "avoid-secrets-in-code",
      "title": "Avoid hardcoded secrets",
      "intent": "Never commit tokens, passwords, or API keys in code; use validated environment variables",
      "scope": "component",
      "severity": "error",
      "rule": "avoid-secrets-in-code"
    },
    {
      "id": "env-validation",
      "title": "Validate environment variables",
      "intent": "Validate env vars with a schema; keep client-safe vs server-only separated",
      "scope": "config",
      "severity": "error",
      "detection": {
        "fileGlobs": ["env.ts", "env.mjs", "env.js", "config/env.ts"],
        "patterns": ["zod", "@t3-oss/env-nextjs"]
      },
      "recommendation": "Use Zod or @t3-oss/env-nextjs to validate all env vars and enforce NEXT_PUBLIC_ on client"
    },
    {
      "id": "security-headers",
      "title": "Set security headers",
      "intent": "Enforce CSP, HSTS, X-Frame-Options, and X-Content-Type-Options",
      "scope": "config",
      "severity": "error",
      "detection": {
        "fileGlobs": ["next.config.js", "next.config.mjs", "next.config.ts", "middleware.ts"],
        "patterns": ["Content-Security-Policy", "Strict-Transport-Security", "X-Frame-Options", "X-Content-Type-Options"]
      },
      "recommendation": "Add secure headers in next.config.{js,ts} or middleware.ts"
    },
    {
      "id": "form-validation-schemas",
      "title": "Use schema-based validation",
      "intent": "Forms and server actions must validate input with schemas",
      "scope": "function",
      "severity": "warning",
      "detection": {
        "patterns": ["<form", "onSubmit", "\"use server\""],
        "astHints": ["zod", "yup", "joi"]
      },
      "recommendation": "Validate inputs with Zod/Yup/Joi in forms and server actions"
    },
    {
      "id": "sentry-integration",
      "title": "Instrument error tracking",
      "intent": "Capture client/server/edge errors with Sentry or equivalent",
      "scope": "project",
      "severity": "warning",
      "detection": {
        "patterns": ["@sentry/nextjs", "Sentry.init", "sentry.client.config", "sentry.server.config"]
      },
      "recommendation": "Install and configure @sentry/nextjs with client/server configs"
    },
    {
      "id": "husky-precommit",
      "title": "Enforce pre-commit hooks",
      "intent": "Run lint/format/tests on staged files via Husky + lint-staged",
      "scope": "project",
      "severity": "info",
      "detection": {
        "fileGlobs": [".husky/pre-commit", "package.json"],
        "patterns": ["husky", "lint-staged"]
      },
      "recommendation": "Configure Husky pre-commit hook to run lint-staged"
    },
    {
      "id": "next-app-router-only",
      "title": "Use App Router Only",
      "intent": "Ensure modern Next.js architecture using the App Router.",
      "scope": "project",
      "severity": "error",
      "detection": {
        "fileGlobs": ["pages/**/*"]
      },
      "recommendation": "Remove the pages/ directory and migrate all routes to the app/ directory.",
      "references": ["https://nextjs.org/docs/app"]
    },
    {
      "id": "prefer-server-components",
      "title": "Prefer Server Components",
      "intent": "Minimize client-side JavaScript and improve performance.",
      "scope": "component",
      "severity": "warning",
      "detection": {
        "patterns": ["\"use client\""]
      },
      "recommendation": "Remove the \"use client\" directive unless browser-only APIs or interactivity are required."
    },
    {
      "id": "no-data-fetching-in-useeffect",
      "title": "Avoid Data Fetching in useEffect",
      "intent": "Encourage server-side data fetching using Server Components or Server Actions.",
      "scope": "component",
      "severity": "error",
      "detection": {
        "astHints": ["useEffect", "fetch"]
      },
      "recommendation": "Move data fetching to a Server Component or use a Server Action."
    },
    {
      "id": "use-server-actions-for-mutations",
      "title": "Use Server Actions for Mutations",
      "intent": "Ensure secure and scalable data mutations.",
      "scope": "function",
      "severity": "error",
      "detection": {
        "patterns": ["fetch\\(.*POST", "axios.post"]
      },
      "recommendation": "Replace client-side mutation calls with validated Server Actions."
    },
    {
      "id": "validate-server-action-inputs",
      "title": "Validate Server Action Inputs",
      "intent": "Prevent malformed or malicious input reaching backend logic.",
      "scope": "function",
      "severity": "error",
      "detection": {
        "patterns": ["\"use server\""]
      },
      "recommendation": "Use schema validation (e.g., Zod) inside Server Actions."
    },
    {
      "id": "no-env-access-in-client",
      "title": "No Environment Variable Access in Client Components",
      "intent": "Prevent secret leakage to the browser.",
      "scope": "component",
      "severity": "error",
      "detection": {
        "patterns": ["process.env"]
      },
      "recommendation": "Only access environment variables in Server Components or Server Actions."
    },
    {
      "id": "use-suspense-boundaries",
      "title": "Use Suspense for Async UI",
      "intent": "Enable streaming and better loading states.",
      "scope": "component",
      "severity": "warning",
      "detection": {
        "astHints": ["await", "async"]
      },
      "recommendation": "Wrap async components in <Suspense> boundaries."
    },
    {
      "id": "use-next-image",
      "title": "Use next/image for Images",
      "intent": "Optimize image loading and performance.",
      "scope": "component",
      "severity": "info",
      "detection": {
        "patterns": ["<img"]
      },
      "recommendation": "Replace <img> tags with the next/image component."
    },
    {
      "id": "use-next-font",
      "title": "Use next/font for Fonts",
      "intent": "Ensure optimal font loading and avoid layout shifts.",
      "scope": "project",
      "severity": "info",
      "detection": {
        "patterns": ["@font-face", "google-fonts"]
      },
      "recommendation": "Use the next/font module for all font loading."
    },
    {
      "id": "no-client-importing-server-only",
      "title": "Client Components Must Not Import Server-Only Code",
      "intent": "Prevent runtime and bundling errors.",
      "scope": "component",
      "severity": "error",
      "detection": {
        "patterns": ["fs", "path", "server-only"]
      },
      "recommendation": "Move server-only imports into Server Components or Server Actions."
    },
    {
      "id": "next-seo-metadata",
      "title": "Use Metadata API for SEO",
      "intent": "Leverage Next.js Metadata API for proper SEO optimization.",
      "scope": "file",
      "severity": "warning",
      "detection": {
        "patterns": ["Head", "meta"]
      },
      "recommendation": "Use the Metadata API instead of Head component. Export metadata object from layout or page files."
    },
    {
      "id": "next-generate-metadata",
      "title": "Generate Dynamic Metadata",
      "intent": "Generate metadata dynamically for better SEO.",
      "scope": "function",
      "severity": "info",
      "recommendation": "Use generateMetadata function to create dynamic metadata based on page params."
    },
    {
      "id": "next-structured-data",
      "title": "Include Structured Data",
      "intent": "Add JSON-LD structured data for search engines.",
      "scope": "page",
      "severity": "info",
      "recommendation": "Include structured data (JSON-LD) in pages for better search engine understanding."
    },
    {
      "id": "next-sitemap-robots",
      "title": "Configure Sitemap and Robots",
      "intent": "Enable search engine crawling and indexing.",
      "scope": "config",
      "severity": "warning",
      "recommendation": "Create sitemap.xml and robots.txt files or use next-sitemap package."
    },
    {
      "id": "next-typescript-strict",
      "title": "Use TypeScript Strict Mode",
      "intent": "Enable TypeScript strict mode for type safety.",
      "scope": "config",
      "severity": "warning",
      "recommendation": "Enable strict, noImplicitAny, and other strict options in tsconfig.json."
    },
    {
      "id": "next-error-handling",
      "title": "Implement Error Handling",
      "intent": "Use error.tsx for error boundaries and global error handling.",
      "scope": "file",
      "severity": "warning",
      "recommendation": "Create error.tsx and global-error.tsx files to handle errors gracefully."
    },
    {
      "id": "next-not-found-handling",
      "title": "Handle Not Found Pages",
      "intent": "Implement not-found.tsx for 404 pages.",
      "scope": "file",
      "severity": "info",
      "recommendation": "Create not-found.tsx files at appropriate levels."
    },
    {
      "id": "next-loading-ui",
      "title": "Implement Loading States",
      "intent": "Use loading.tsx for streaming UI.",
      "scope": "file",
      "severity": "info",
      "recommendation": "Create loading.tsx files to show loading skeletons while data is being fetched."
    },
    {
      "id": "next-middleware-usage",
      "title": "Use Middleware for Auth and Routing",
      "intent": "Implement middleware for authentication and routing logic.",
      "scope": "file",
      "severity": "warning",
      "recommendation": "Create middleware.ts to handle authentication, redirects, and request processing."
    },
    {
      "id": "next-revalidation-strategy",
      "title": "Choose Appropriate Revalidation Strategy",
      "intent": "Use time-based, on-demand, or tag-based revalidation.",
      "scope": "function",
      "severity": "warning",
      "recommendation": "Use revalidatePath, revalidateTag, or set next.revalidate in fetch options."
    },
    {
      "id": "next-edge-functions",
      "title": "Consider Edge Functions for Performance",
      "intent": "Use Edge Functions for low-latency operations.",
      "scope": "file",
      "severity": "info",
      "recommendation": "Use edge runtime for middleware and API routes that benefit from edge execution."
    },
    {
      "id": "next-dynamic-imports",
      "title": "Use dynamic() for Code Splitting",
      "intent": "Split code dynamically to reduce bundle size.",
      "scope": "component",
      "severity": "warning",
      "recommendation": "Use next/dynamic for large components that don't need immediate rendering."
    },
    {
      "id": "next-css-modules",
      "title": "Prefer CSS Modules or Tailwind",
      "intent": "Use scoped styling to avoid CSS conflicts.",
      "scope": "style",
      "severity": "info",
      "recommendation": "Use CSS Modules or Tailwind CSS instead of global CSS or CSS-in-JS that conflicts with SSR."
    },
    {
      "id": "next-parallel-routes",
      "title": "Use Parallel Routes",
      "intent": "Render multiple segments simultaneously.",
      "scope": "architecture",
      "severity": "info",
      "recommendation": "Use parallel routes (@folder notation) for independent routes."
    },
    {
      "id": "next-intercepting-routes",
      "title": "Use Intercepting Routes",
      "intent": "Intercept routes for modal and interception patterns.",
      "scope": "architecture",
      "severity": "info",
      "recommendation": "Use intercepting routes for advanced patterns like modals and interceptions."
    },
    {
      "id": "next-route-groups",
      "title": "Use Route Groups for Organization",
      "intent": "Organize routes logically without affecting URL structure.",
      "scope": "architecture",
      "severity": "info",
      "recommendation": "Use route groups (parentheses notation) to organize related routes."
    },
    {
      "id": "next-api-routes-safety",
      "title": "Secure API Routes",
      "intent": "Implement proper authentication and validation in API routes.",
      "scope": "function",
      "severity": "error",
      "recommendation": "Validate requests, authenticate users, and implement proper error handling in API routes."
    },
    {
      "id": "next-deployment-readiness",
      "title": "Ensure Deployment Readiness",
      "intent": "Configure for optimal deployment.",
      "scope": "config",
      "severity": "warning",
      "recommendation": "Set output: 'standalone' for Docker, configure environment variables, and optimize build settings."
    }
  ]
}
