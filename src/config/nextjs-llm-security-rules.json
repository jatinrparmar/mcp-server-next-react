{
  "meta": {
    "framework": "Next.js",
    "version": "2025",
    "type": "security",
    "intendedFor": ["LLMs", "MCP", "GitHub Copilot"]
  },
  "securityRules": [
    {
      "id": "no-env-variable-exposure",
      "title": "Prevent Environment Variable Exposure",
      "intent": "Ensure sensitive environment variables are not exposed to the client side.",
      "scope": "code",
      "severity": "critical",
      "enabled": true,
      "detection": {
        "patterns": [
          "process\\.env\\.(?!NEXT_PUBLIC_)",
          "process\\.env\\.([A-Z_]*(SECRET|PASSWORD|KEY|TOKEN|API)[A-Z_]*)"
        ],
        "fileExtensions": [".ts", ".tsx", ".js", ".jsx"],
        "excludePatterns": ["src/app/**/**/server.ts", "src/pages/api/**"]
      },
      "recommendation": "Only use environment variables prefixed with NEXT_PUBLIC_ on the client side. For sensitive data, use server-only modules or server actions.",
      "references": [
        "https://nextjs.org/docs/app/building-your-application/configuring/environment-variables"
      ],
      "codeExample": {
        "bad": "const apiKey = process.env.API_KEY; // Exposed to client",
        "good": "const apiKey = process.env.NEXT_PUBLIC_API_KEY; // Safe for client"
      }
    },
    {
      "id": "server-action-validation",
      "title": "Validate Server Actions Input",
      "intent": "Ensure server actions validate all user inputs to prevent injection attacks.",
      "scope": "function",
      "severity": "critical",
      "enabled": true,
      "detection": {
        "patterns": ["'use server'", "\"use server\""],
        "requirePatterns": [
          "zod\\.parse|yup\\.validate|joi\\.validate",
          "validate|sanitize|schema"
        ]
      },
      "recommendation": "Always validate and sanitize inputs in server actions using libraries like Zod, Yup, or Joi. Never trust client-side input.",
      "references": [
        "https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations#validation",
        "https://owasp.org/www-community/attacks/injection"
      ],
      "codeExample": {
        "bad": "'use server';\nexport async function updateUser(formData) {\n  // No validation!\n  db.update(formData);\n}",
        "good": "'use server';\nimport { z } from 'zod';\nconst schema = z.object({ name: z.string() });\nexport async function updateUser(data) {\n  const validated = schema.parse(data);\n  db.update(validated);\n}"
      },
      "owasp": "A03:2021 - Injection",
      "confidence": "high",
      "falsePositives": "low",
      "performanceImpact": "low",
      "easeOfRemediation": "medium",
      "detectionExplanation": "Scans for server actions lacking input validation patterns.",
      "remediationExplanation": "Implement input validation using recognized libraries.",
      "examplesOfExploits": [
        "An attacker submits malicious input to a server action that directly interacts with a database, leading to SQL injection.",
        "User input is used in file operations without validation, allowing path traversal attacks."
      ],
      "relatedVulnerabilities": ["SQL Injection"],
      "detectionLimitations": "May not detect custom validation implementations.",
      "additionalNotes": "Ensure all server actions are reviewed for proper input handling."
    },
    {
      "id": "no-hardcoded-secrets",
      "title": "No Hardcoded Secrets",
      "intent": "Prevent hardcoded API keys, tokens, and passwords in source code.",
      "scope": "code",
      "severity": "critical",
      "enabled": true,
      "detection": {
        "patterns": [
          "password\\s*[=:]\\s*['\\\"].*['\\\"]",
          "api[_-]?key\\s*[=:]\\s*['\\\"].*['\\\"]",
          "secret\\s*[=:]\\s*['\\\"].*['\\\"]",
          "token\\s*[=:]\\s*['\\\"].*['\\\"]"
        ],
        "excludePatterns": ["*.test.*", "*.spec.*", "mock*"]
      },
      "recommendation": "Store all secrets in environment variables or a secure secrets management system. Never commit secrets to version control.",
      "references": [
        "https://owasp.org/www-community/vulnerabilities/Sensitive_Data_Exposure",
        "https://github.com/gremlin/api-security/blob/master/Hardcoded_Secrets.md"
      ],
      "codeExample": {
        "bad": "const apiKey = 'sk-1234567890abcdef';",
        "good": "const apiKey = process.env.NEXT_PUBLIC_API_KEY;"
      },
      "condition": "true",
      "conditionExplanation": "Applies to all projects.",
      "owasp": "A02:2021 - Cryptographic Failures",
      "confidence": "high",
      "falsePositives": "low",
      "performanceImpact": "low",
      "easeOfRemediation": "high",
      "detectionExplanation": "Scans for common patterns of hardcoded secrets in code files.",
      "remediationExplanation": "Remove hardcoded secrets and use environment variables or secure storage.",
      "examplesOfExploits": [
        "An attacker gains access to an API key hardcoded in the source code, allowing unauthorized access to third-party services.",
        "A leaked password in the codebase leads to unauthorized database access."
      ],
      "relatedVulnerabilities": ["Sensitive Data Exposure"],
      "detectionLimitations": "May not detect obfuscated or uncommon secret patterns.",
      "additionalNotes": "Regularly audit codebases for hardcoded secrets and rotate any exposed credentials."
    },
    {
      "id": "xss-prevention",
      "title": "Prevent XSS Vulnerabilities",
      "intent": "Ensure dynamic content is properly sanitized and escaped to prevent XSS attacks.",
      "scope": "component",
      "severity": "high",
      "enabled": true,
      "detection": {
        "patterns": [
          "dangerouslySetInnerHTML",
          "innerHTML",
          "eval\\s*\\(",
          "Function\\s*\\("
        ]
      },
      "recommendation": "Avoid using dangerouslySetInnerHTML. Use libraries like DOMPurify or react-html-parser for sanitization. React escapes content by default.",
      "references": [
        "https://react.dev/reference/react-dom/dangerouslySetInnerHTML",
        "https://owasp.org/www-community/attacks/xss/"
      ],
      "codeExample": {
        "bad": "return <div dangerouslySetInnerHTML={{ __html: userInput }} />;",
        "good": "return <div>{userInput}</div>; // React auto-escapes"
      },
      "condition": "true",
      "conditionExplanation": "Applies to all React components.",
      "owasp": "A07:2021 - Identification and Authentication Failures",
      "confidence": "high",
      "falsePositives": "medium",
      "performanceImpact": "low",
      "easeOfRemediation": "medium",
      "detectionExplanation": "Scans for usage of patterns known to introduce XSS vulnerabilities.",
      "remediationExplanation": "Refactor code to avoid unsafe patterns and implement proper sanitization.",
      "examplesOfExploits": [
        "An attacker injects malicious JavaScript through user input that is rendered using dangerouslySetInnerHTML, leading to session hijacking.",
        "Using eval() on user input allows execution of arbitrary scripts in the context of the application."
      ],
      "relatedVulnerabilities": ["Cross-Site Scripting (XSS)"],
      "detectionLimitations": "May not catch all instances of unsafe content rendering, especially in complex codebases.",
      "additionalNotes": "Regularly review components for safe content rendering practices."
    },
    {
      "id": "sql-injection-prevention",
      "title": "Prevent SQL Injection",
      "intent": "Use parameterized queries or ORM to prevent SQL injection attacks.",
      "scope": "code",
      "severity": "critical",
      "enabled": true,
      "detection": {
        "patterns": [
          "\\+\\s*['\\\"].*['\\\"]|template.*\\$\\{",
          "query\\s*\\+|sql\\s*\\+"
        ],
        "requireAbsence": [
          "parameterized|prepared|\\?|\\$[0-9]|prisma|sequelize|typeorm"
        ]
      },
      "recommendation": "Always use parameterized queries, prepared statements, or an ORM like Prisma. Never concatenate strings for SQL queries.",
      "references": [
        "https://owasp.org/www-community/attacks/SQL_Injection",
        "https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html"
      ],
      "codeExample": {
        "bad": "db.query(`SELECT * FROM users WHERE id = ${userId}`);",
        "good": "db.query('SELECT * FROM users WHERE id = ?', [userId]);"
      },
      "condition": "true",
      "conditionExplanation": "Applies to projects using SQL databases."
    },
    {
      "id": "csp-headers",
      "title": "Configure Content Security Policy Headers",
      "intent": "Ensure CSP headers are configured to prevent injection attacks.",
      "scope": "config",
      "severity": "high",
      "enabled": true,
      "detection": {
        "fileGlobs": ["next.config.*", "src/middleware.*"],
        "requirePatterns": ["Content-Security-Policy|csp|headers"]
      },
      "recommendation": "Configure CSP headers in next.config.js or middleware to restrict resource loading. This mitigates XSS attacks.",
      "references": [
        "https://nextjs.org/docs/advanced-features/security-headers",
        "https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP"
      ],
      "codeExample": {
        "bad": "// No CSP headers configured",
        "good": "// next.config.js\nmodule.exports = {\n  async headers() {\n    return [{ source: '/:path*', headers: [{ key: 'Content-Security-Policy', value: \"default-src 'self'\" }] }];\n  }\n};"
      },
      "condition": "true",
      "conditionExplanation": "Applies to all Next.js projects.",
      "owasp": "A05:2021 - Security Misconfiguration",
      "confidence": "high",
      "falsePositives": "low",
      "performanceImpact": "low",
      "easeOfRemediation": "medium",
      "detectionExplanation": "Scans configuration files for presence of CSP header settings.",
      "remediationExplanation": "Add or update CSP headers to enhance security posture.",
      "examplesOfExploits": [
        "An attacker exploits the absence of CSP headers to inject malicious scripts into the application, leading to XSS attacks.",
        "Without CSP, an attacker can load resources from untrusted domains, increasing the risk of data theft."
      ],
      "relatedVulnerabilities": ["Cross-Site Scripting (XSS)"],
      "detectionLimitations": "May not detect dynamically set headers at runtime.",
      "additionalNotes": "Regularly review and update CSP policies as the application evolves."
    },
    {
      "id": "csrf-protection",
      "title": "CSRF Token Protection",
      "intent": "Implement CSRF token validation for state-changing operations.",
      "scope": "function",
      "severity": "high",
      "enabled": true,
      "detection": {
        "patterns": ["'use server'", "\"use server\""],
        "requireAbsence": ["csrf|token|nonce"]
      },
      "recommendation": "Use CSRF tokens in forms and validate them in server actions. Next.js provides built-in CSRF protection.",
      "references": [
        "https://owasp.org/www-community/attacks/csrf",
        "https://nextjs.org/docs/app/building-your-application/security/securing-pages-and-apis"
      ],
      "codeExample": {
        "bad": "'use server';\nexport async function updateData(data) {\n  // No CSRF protection\n}",
        "good": "'use server';\nexport async function updateData(data) {\n  // Validate CSRF token\n  const token = cookies().get('csrf-token')?.value;\n  if (!token) throw new Error('CSRF token missing');\n}"
      },
      "condition": "true",
      "conditionExplanation": "Applies to all server actions handling state changes.",
      "owasp": "A08:2021 - Software and Data Integrity Failures",
      "confidence": "high",
      "falsePositives": "low",
      "performanceImpact": "low",
      "easeOfRemediation": "medium",
      "detectionExplanation": "Scans server actions for absence of CSRF token validation patterns.",
      "remediationExplanation": "Implement CSRF token checks in all state-changing server actions.",
      "examplesOfExploits": [
        "An attacker tricks a logged-in user into submitting a form that changes their account details without their consent.",
        "Malicious websites exploit the lack of CSRF protection to perform unauthorized actions on behalf of authenticated users."
      ],
      "relatedVulnerabilities": ["Cross-Site Request Forgery (CSRF)"],
      "detectionLimitations": "May not detect custom CSRF implementations.",
      "additionalNotes": "Ensure all forms and state-changing requests include CSRF tokens."
    },
    {
      "id": "secure-headers",
      "title": "Implement Security Headers",
      "intent": "Ensure all recommended security headers are configured.",
      "scope": "config",
      "severity": "high",
      "enabled": true,
      "detection": {
        "fileGlobs": ["next.config.*", "src/middleware.*"],
        "requirePatterns": [
          "X-Content-Type-Options|X-Frame-Options|X-XSS-Protection"
        ]
      },
      "recommendation": "Configure security headers including X-Content-Type-Options, X-Frame-Options, and Strict-Transport-Security.",
      "references": [
        "https://nextjs.org/docs/advanced-features/security-headers",
        "https://owasp.org/www-project-secure-headers/"
      ],
      "codeExample": {
        "bad": "// No security headers",
        "good": "// Middleware\nexport function middleware(request) {\n  const response = NextResponse.next();\n  response.headers.set('X-Content-Type-Options', 'nosniff');\n  response.headers.set('X-Frame-Options', 'DENY');\n  return response;\n}"
      },
      "condition": "true",
      "conditionExplanation": "Applies to all Next.js projects.",
      "owasp": "A05:2021 - Security Misconfiguration",
      "confidence": "high",
      "falsePositives": "low",
      "performanceImpact": "low",
      "easeOfRemediation": "medium",
      "detectionExplanation": "Scans configuration files for presence of key security headers.",
      "remediationExplanation": "Add missing security headers to enhance application security.",
      "examplesOfExploits": [
        "An attacker exploits the absence of X-Frame-Options to perform clickjacking attacks.",
        "Without X-Content-Type-Options, browsers may interpret files as a different MIME type, leading to XSS vulnerabilities."
      ],
      "relatedVulnerabilities": ["Clickjacking", "Cross-Site Scripting (XSS)"],
      "detectionLimitations": "May not detect headers set dynamically at runtime.",
      "additionalNotes": "Regularly review and update security headers as part of security best practices."
    },
    {
      "id": "auth-validation",
      "title": "Validate Authentication and Authorization",
      "intent": "Ensure proper authentication and authorization checks on protected resources.",
      "scope": "function",
      "severity": "critical",
      "enabled": true,
      "detection": {
        "patterns": ["'use server'", "\"use server\"", "/api/"],
        "requireAbsence": ["auth|session|permission|isAuthorized"]
      },
      "recommendation": "Always validate user sessions and check permissions before accessing protected resources. Use middleware for route protection.",
      "references": [
        "https://owasp.org/www-community/attacks/Broken_Authentication"
      ],
      "codeExample": {
        "bad": "'use server';\nexport async function deleteUser(userId) {\n  db.deleteUser(userId);\n}",
        "good": "'use server';\nexport async function deleteUser(userId) {\n  const session = await getSession();\n  if (!session?.user) throw new Error('Unauthorized');\n  db.deleteUser(userId);\n}"
      },
      "condition": "true",
      "conditionExplanation": "Applies to all server actions and API routes.",
      "owasp": "A01:2021 - Broken Access Control",
      "confidence": "high",
      "falsePositives": "low",
      "performanceImpact": "low",
      "easeOfRemediation": "medium",
      "detectionExplanation": "Scans server actions and API routes for absence of authentication and authorization checks.",
      "remediationExplanation": "Implement proper session validation and permission checks in all protected functions.",
      "examplesOfExploits": [
        "An attacker accesses sensitive user data by exploiting a server action that lacks authentication checks.",
        "Unauthorized users perform administrative actions due to missing authorization validations."
      ],
      "relatedVulnerabilities": ["Broken Access Control"],
      "detectionLimitations": "May not detect custom authentication implementations.",
      "additionalNotes": "Regularly audit protected resources for proper access controls."
    },
    {
      "id": "dependency-vulnerabilities",
      "title": "Check for Vulnerable Dependencies",
      "intent": "Ensure no known vulnerable packages are installed.",
      "scope": "project",
      "severity": "high",
      "enabled": true,
      "detection": {
        "fileGlobs": ["package.json"],
        "checkPatterns": ["audit"]
      },
      "recommendation": "Regularly run 'npm audit' or 'yarn audit' and update vulnerable dependencies. Use dependabot for automated updates.",
      "references": [
        "https://docs.npmjs.com/cli/v8/commands/npm-audit",
        "https://docs.github.com/en/code-security/dependabot"
      ],
      "codeExample": {
        "bad": "// Old vulnerable version in package.json\n\"lodash\": \"3.10.0\"",
        "good": "// Updated to secure version\n\"lodash\": \"^4.17.21\""
      },
      "condition": "true",
      "conditionExplanation": "Applies to all projects using npm or yarn.",
      "owasp": "A06:2021 - Vulnerable and Outdated Components",
      "confidence": "high",
      "falsePositives": "low",
      "performanceImpact": "low",
      "easeOfRemediation": "high",
      "detectionExplanation": "Scans package.json for known vulnerable dependencies using audit reports.",
      "remediationExplanation": "Update or replace vulnerable packages to secure versions.",
      "examplesOfExploits": [
        "An attacker exploits a known vulnerability in an outdated library to execute arbitrary code.",
        "Using a vulnerable package leads to data breaches due to unpatched security flaws."
      ],
      "relatedVulnerabilities": ["Remote Code Execution", "Data Breach"],
      "detectionLimitations": "May not detect vulnerabilities in private or custom packages.",
      "additionalNotes": "Incorporate dependency checks into regular development workflows."
    },
    {
      "id": "no-console-sensitive-data",
      "title": "No Sensitive Data in Console",
      "intent": "Prevent logging of sensitive information.",
      "scope": "code",
      "severity": "medium",
      "enabled": true,
      "detection": {
        "patterns": [
          "console\\.(log|debug|error)\\s*\\([^)]*password[^)]*\\)",
          "console\\.(log|debug|error)\\s*\\([^)]*token[^)]*\\)",
          "console\\.(log|debug|error)\\s*\\([^)]*secret[^)]*\\)"
        ]
      },
      "recommendation": "Remove logging of passwords, tokens, and other sensitive data. Use appropriate log levels and secure logging services.",
      "references": ["https://owasp.org/www-community/Log_Injection"],
      "codeExample": {
        "bad": "console.log('User password:', password);",
        "good": "console.log('Login attempt for user:', username);"
      },
      "condition": "true",
      "conditionExplanation": "Applies to all code files.",
      "owasp": "A09:2021 - Security Logging and Monitoring Failures",
      "confidence": "high",
      "falsePositives": "low",
      "performanceImpact": "low",
      "easeOfRemediation": "high",
      "detectionExplanation": "Scans for console logging statements that include sensitive keywords.",
      "remediationExplanation": "Remove or sanitize logging statements that expose sensitive information.",
      "examplesOfExploits": [
        "An attacker gains access to sensitive user credentials by monitoring application logs that contain passwords.",
        "Sensitive tokens logged to the console are exposed in production environments, leading to unauthorized access."
      ],
      "relatedVulnerabilities": ["Log Injection", "Sensitive Data Exposure"],
      "detectionLimitations": "May not detect obfuscated logging statements.",
      "additionalNotes": "Implement secure logging practices and review logs regularly for sensitive data exposure."
    },
    {
      "id": "react2shell-command-injection",
      "title": "Prevent React2Shell Command Injection",
      "intent": "Detect cases where user-controlled input in Next.js flows into OS or shell execution APIs, potentially leading to command injection vulnerabilities.",
      "scope": "server",
      "severity": "critical",
      "enabled": true,
      "detection": {
        "patterns": [
          "child_process\\.exec\\s*\\(",
          "child_process\\.execSync\\s*\\(",
          "child_process\\.spawn\\s*\\(",
          "child_process\\.spawnSync\\s*\\(",
          "\\bexec\\s*\\(",
          "\\bexecSync\\s*\\(",
          "\\bspawn\\s*\\(",
          "\\bspawnSync\\s*\\("
        ],
        "sources": [
          "req.body",
          "req.query",
          "req.params",
          "searchParams",
          "cookies",
          "headers",
          "formData.get",
          "event.target.value"
        ],
        "excludePatterns": [
          "shell-escape",
          "execa",
          "zod\\.parse",
          "safeParse",
          "allowlist",
          "whitelist"
        ],
        "fileExtensions": [".ts", ".js"],
        "taintTracking": true
      },
      "recommendation": "Never pass user-controlled input directly to shell execution APIs. Use strict allowlists, argument arrays, and validated input. Prefer safe libraries like execa with fixed commands.",
      "references": [
        "https://owasp.org/www-community/attacks/Command_Injection",
        "https://nodejs.org/api/child_process.html",
        "https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions"
      ],
      "codeExample": {
        "bad": "'use server';\nimport { exec } from 'child_process';\nexport async function run(cmd) {\n  exec(cmd); // User input\n}",
        "good": "'use server';\nimport { spawn } from 'child_process';\nconst ALLOWED = ['ls', 'pwd'];\nexport async function run(cmd) {\n  if (!ALLOWED.includes(cmd)) throw new Error('Invalid command');\n  spawn(cmd, [], { shell: false });\n}"
      },
      "owasp": "A03:2021 - Injection",
      "confidence": "high",
      "falsePositives": "medium",
      "performanceImpact": "medium",
      "easeOfRemediation": "medium",
      "detectionExplanation": "Uses taint tracking to identify user input flowing into shell execution APIs.",
      "remediationExplanation": "Validate and sanitize all user inputs before using them in shell commands.",
      "examplesOfExploits": [
        "An attacker submits a malicious command through a web form that gets executed on the server, leading to unauthorized access.",
        "User input is directly passed to a shell command, allowing execution of arbitrary commands."
      ],
      "relatedVulnerabilities": ["Command Injection"],
      "detectionLimitations": "May not detect complex data flows or custom shell execution wrappers.",
      "additionalNotes": "Regularly review code for safe handling of user inputs in server-side operations."
    }
  ]
}
